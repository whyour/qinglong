# åœºæ™¯æ¨¡å¼å®ç°æ€»ç»“ (Scenario Mode Implementation Summary)

## ğŸ“Š å®ç°ç»Ÿè®¡ (Implementation Statistics)

- **æ–°å¢æ–‡ä»¶**: 8 ä¸ª (8 new files)
- **ä¿®æ”¹æ–‡ä»¶**: 6 ä¸ª (6 modified files)
- **ä»£ç è¡Œæ•°**: ~2,100 è¡Œæ–°å¢ä»£ç  (~2,100 lines of new code)
- **åŠŸèƒ½æ•°é‡**: 5 ç§è§¦å‘å™¨ + 4 ç§åŠ¨ä½œ (5 triggers + 4 actions)
- **è¯­è¨€æ”¯æŒ**: ä¸­æ–‡ + è‹±æ–‡ (Chinese + English)

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å®ç° (Core Features Implemented)

### 1. æ•°æ®æ¨¡å‹ (Data Models)
```
back/data/scenario.ts       - åœºæ™¯æ•°æ®æ¨¡å‹ (117 lines)
back/data/scenarioLog.ts    - æ—¥å¿—æ•°æ®æ¨¡å‹ (58 lines)
```

**ç‰¹æ€§**:
- å®Œæ•´çš„åœºæ™¯é…ç½®å­˜å‚¨
- è§¦å‘å™¨ã€æ¡ä»¶ã€åŠ¨ä½œçš„çµæ´»é…ç½®
- æ‰§è¡Œç»Ÿè®¡å’ŒçŠ¶æ€è·Ÿè¸ª
- è¯¦ç»†çš„æ—¥å¿—è®°å½•

### 2. åç«¯æœåŠ¡ (Backend Service)
```
back/services/scenario.ts   - åœºæ™¯æœåŠ¡ (501 lines)
```

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… åœºæ™¯ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ï¼‰
- âœ… 5 ç§è§¦å‘å™¨å®ç°
- âœ… æ¡ä»¶è¯„ä¼°å¼•æ“
- âœ… åŠ¨ä½œæ‰§è¡Œå¼•æ“
- âœ… å¤±è´¥ç†”æ–­æœºåˆ¶
- âœ… è‡ªé€‚åº”é‡è¯•ç­–ç•¥
- âœ… å®Œæ•´çš„æ—¥å¿—ç³»ç»Ÿ

### 3. API æ¥å£ (API Endpoints)
```
back/api/scenario.ts        - REST API (214 lines)
```

**ç«¯ç‚¹åˆ—è¡¨**:
- `GET /api/scenarios` - è·å–åœºæ™¯åˆ—è¡¨
- `POST /api/scenarios` - åˆ›å»ºåœºæ™¯
- `PUT /api/scenarios` - æ›´æ–°åœºæ™¯
- `DELETE /api/scenarios` - åˆ é™¤åœºæ™¯
- `POST /api/scenarios/:id/trigger` - æ‰‹åŠ¨è§¦å‘
- `GET /api/scenarios/:id/webhook` - è·å– Webhook URL
- `GET /api/scenarios/logs` - æŸ¥è¯¢æ—¥å¿—
- `POST /api/scenarios/webhook/:token` - Webhook è§¦å‘

### 4. å‰ç«¯ç•Œé¢ (Frontend UI)
```
src/pages/scenario/index.tsx    - ä¸»é¡µé¢ (318 lines)
src/pages/scenario/modal.tsx    - ç¼–è¾‘å™¨ (443 lines)
src/pages/scenario/logModal.tsx - æ—¥å¿—æŸ¥çœ‹ (130 lines)
```

**ç•Œé¢åŠŸèƒ½**:
- ğŸ“‹ åœºæ™¯åˆ—è¡¨ç®¡ç†
- âœï¸ å¯è§†åŒ–åœºæ™¯ç¼–è¾‘å™¨
- ğŸ”§ åŠ¨æ€è§¦å‘å™¨é…ç½®
- ğŸ§© æ¡ä»¶æ„å»ºå™¨ (AND/OR)
- âš¡ åŠ¨ä½œé…ç½®å™¨
- ğŸ“Š æ‰§è¡Œç»Ÿè®¡å±•ç¤º
- ğŸ“ æ—¥å¿—æŸ¥çœ‹å™¨
- ğŸ”— Webhook ç®¡ç†

### 5. å›½é™…åŒ–æ”¯æŒ (i18n)
```
src/locales/zh-CN.json      - ä¸­æ–‡ç¿»è¯‘ (+72 entries)
src/locales/en-US.json      - è‹±æ–‡ç¿»è¯‘ (+72 entries)
```

## ğŸ”§ æŠ€æœ¯æ¶æ„ (Technical Architecture)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯å±‚ (Frontend)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åœºæ™¯åˆ—è¡¨    â”‚   åœºæ™¯ç¼–è¾‘å™¨   â”‚   æ—¥å¿—æŸ¥çœ‹å™¨           â”‚
â”‚  (List)     â”‚   (Editor)    â”‚   (Log Viewer)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†• HTTP API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API å±‚ (API Layer)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åœºæ™¯ç®¡ç†    â”‚   æ‰‹åŠ¨è§¦å‘    â”‚   Webhook     â”‚  æ—¥å¿—   â”‚
â”‚  (CRUD)     â”‚   (Trigger)  â”‚   (External)  â”‚  (Logs) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†• Service Layer
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æœåŠ¡å±‚ (Service Layer)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ è§¦å‘å™¨ç®¡ç†   â”‚  â”‚ æ¡ä»¶è¯„ä¼°å¼•æ“ â”‚  â”‚ åŠ¨ä½œæ‰§è¡Œå¼•æ“ â”‚ â”‚
â”‚  â”‚ (Triggers)   â”‚  â”‚ (Conditions) â”‚  â”‚  (Actions)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ å¤±è´¥ç†”æ–­     â”‚  â”‚ é‡è¯•ç­–ç•¥     â”‚  â”‚ æ—¥å¿—è®°å½•     â”‚ â”‚
â”‚  â”‚ (Breaker)    â”‚  â”‚ (Retry)      â”‚  â”‚ (Logging)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†• Data Layer
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•°æ®å±‚ (Data Layer)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Scenario è¡¨        â”‚       ScenarioLog è¡¨              â”‚
â”‚  (åœºæ™¯é…ç½®)         â”‚       (æ‰§è¡Œæ—¥å¿—)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¨ è§¦å‘å™¨è¯¦è§£ (Trigger Details)

### 1. Variable Monitor (å˜é‡ç›‘å¬)
```javascript
{
  triggerType: 'variable',
  triggerConfig: {
    watchPath: '/path/to/watch'
  }
}
```
**å·¥ä½œåŸç†**: ä½¿ç”¨ chokidar ç›‘æ§æ–‡ä»¶ç³»ç»Ÿå˜åŒ–

### 2. Webhook Trigger (Webhook è§¦å‘)
```javascript
{
  triggerType: 'webhook',
  triggerConfig: {
    token: 'auto-generated-or-custom'
  }
}
```
**å·¥ä½œåŸç†**: ç”Ÿæˆå”¯ä¸€ Tokenï¼Œé€šè¿‡ HTTP POST æ¥æ”¶è§¦å‘

### 3. Task Status Trigger (ä»»åŠ¡çŠ¶æ€)
```javascript
{
  triggerType: 'task_status',
  triggerConfig: {
    cronId: 123,
    status: 'success' // or 'failure'
  }
}
```
**å·¥ä½œåŸç†**: ç›‘å¬å®šæ—¶ä»»åŠ¡æ‰§è¡Œç»“æœ

### 4. Time Trigger (æ—¶é—´è§¦å‘)
```javascript
{
  triggerType: 'time',
  triggerConfig: {
    schedule: '0 0 * * *'  // Cron expression
  }
}
```
**å·¥ä½œåŸç†**: ä½¿ç”¨ Cron è¡¨è¾¾å¼å®šæ—¶è§¦å‘

### 5. System Event Trigger (ç³»ç»Ÿäº‹ä»¶)
```javascript
{
  triggerType: 'system_event',
  triggerConfig: {
    eventType: 'disk_space', // or 'memory'
    threshold: 80,            // percentage
    checkInterval: 60000      // milliseconds
  }
}
```
**å·¥ä½œåŸç†**: å®šæœŸæ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡

## ğŸ§© æ¡ä»¶é€»è¾‘ç¤ºä¾‹ (Condition Logic Examples)

### AND é€»è¾‘ï¼ˆå…¨éƒ¨æ»¡è¶³ï¼‰
```json
{
  "conditionLogic": "AND",
  "conditions": [
    { "field": "status", "operator": "equals", "value": "success" },
    { "field": "branch", "operator": "equals", "value": "main" }
  ]
}
```

### OR é€»è¾‘ï¼ˆä»»ä¸€æ»¡è¶³ï¼‰
```json
{
  "conditionLogic": "OR",
  "conditions": [
    { "field": "branch", "operator": "equals", "value": "main" },
    { "field": "branch", "operator": "equals", "value": "develop" }
  ]
}
```

### æ”¯æŒçš„æ“ä½œç¬¦
- `equals` - ç­‰äº
- `not_equals` - ä¸ç­‰äº
- `greater_than` - å¤§äº
- `less_than` - å°äº
- `contains` - åŒ…å«
- `not_contains` - ä¸åŒ…å«

## âš¡ åŠ¨ä½œç±»å‹è¯¦è§£ (Action Types)

### 1. Run Task (è¿è¡Œä»»åŠ¡)
```json
{
  "type": "run_task",
  "cronId": 123
}
```

### 2. Set Variable (è®¾ç½®å˜é‡)
```json
{
  "type": "set_variable",
  "name": "DEPLOY_STATUS",
  "value": "completed"
}
```

### 3. Execute Command (æ‰§è¡Œå‘½ä»¤)
```json
{
  "type": "execute_command",
  "command": "rm -rf /tmp/cache/*"
}
```

### 4. Send Notification (å‘é€é€šçŸ¥)
```json
{
  "type": "send_notification",
  "message": "Deployment completed successfully"
}
```

## ğŸ›¡ï¸ å¯é æ€§æœºåˆ¶ (Reliability Mechanisms)

### å¤±è´¥ç†”æ–­ (Circuit Breaker)
```javascript
{
  failureThreshold: 3,  // è¿ç»­å¤±è´¥ 3 æ¬¡åè‡ªåŠ¨ç¦ç”¨
  consecutiveFailures: 0 // å½“å‰è¿ç»­å¤±è´¥æ¬¡æ•°
}
```

### è‡ªé€‚åº”é‡è¯• (Adaptive Retry)
```javascript
{
  retryStrategy: {
    maxRetries: 3,          // æœ€å¤šé‡è¯• 3 æ¬¡
    retryDelay: 5,          // åŸºç¡€å»¶è¿Ÿ 5 ç§’
    backoffMultiplier: 2    // æ¯æ¬¡å»¶è¿Ÿç¿»å€
  }
}
// é‡è¯•å»¶è¿Ÿ: 5s, 10s, 20s
```

### å»¶è¿Ÿæ‰§è¡Œ (Delayed Execution)
```javascript
{
  delayExecution: 30  // è§¦å‘åå»¶è¿Ÿ 30 ç§’æ‰§è¡Œ
}
```

## ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯ (Statistics)

æ¯ä¸ªåœºæ™¯å®æ—¶è·Ÿè¸ªï¼š
- `executionCount` - æ€»æ‰§è¡Œæ¬¡æ•°
- `successCount` - æˆåŠŸæ¬¡æ•°
- `failureCount` - å¤±è´¥æ¬¡æ•°
- `consecutiveFailures` - è¿ç»­å¤±è´¥æ¬¡æ•°
- `lastTriggeredAt` - æœ€åè§¦å‘æ—¶é—´
- `lastExecutedAt` - æœ€åæ‰§è¡Œæ—¶é—´

## ğŸ” æ—¥å¿—ç³»ç»Ÿ (Logging System)

æ¯æ¬¡æ‰§è¡Œè®°å½•ï¼š
- è§¦å‘æ•°æ® (`triggerData`)
- æ¡ä»¶åŒ¹é…ç»“æœ (`conditionsMatched`)
- æ‰§è¡ŒçŠ¶æ€ (`executionStatus`: success/failure/partial)
- æ‰§è¡Œè¯¦æƒ… (`executionDetails`)
- é”™è¯¯ä¿¡æ¯ (`errorMessage`)
- æ‰§è¡Œè€—æ—¶ (`executionTime`)
- é‡è¯•æ¬¡æ•° (`retriesAttempted`)
- åˆ›å»ºæ—¶é—´ (`createdAt`)

## ğŸ¯ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹ (Use Case Examples)

### åœºæ™¯ 1: é…ç½®æ–‡ä»¶è‡ªåŠ¨é‡è½½
```
è§¦å‘å™¨: Variable Monitor
  - ç›‘å¬: /config/app.json
æ¡ä»¶: æ— 
åŠ¨ä½œ: 
  1. Execute Command - "pm2 reload app"
  2. Send Notification - "é…ç½®å·²æ›´æ–°å¹¶é‡è½½"
```

### åœºæ™¯ 2: CI/CD é›†æˆ
```
è§¦å‘å™¨: Webhook
æ¡ä»¶: 
  - event = "deployment" AND
  - status = "success" AND
  - branch = "main"
åŠ¨ä½œ:
  1. Run Task - æ‰§è¡Œéƒ¨ç½²åæ¸…ç†ä»»åŠ¡
  2. Set Variable - LAST_DEPLOY_TIME = ${timestamp}
```

### åœºæ™¯ 3: ç£ç›˜ç©ºé—´å‘Šè­¦
```
è§¦å‘å™¨: System Event
  - äº‹ä»¶ç±»å‹: disk_space
  - é˜ˆå€¼: 85%
æ¡ä»¶: æ— 
åŠ¨ä½œ:
  1. Execute Command - "æ¸…ç†ä¸´æ—¶æ–‡ä»¶"
  2. Send Notification - "ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œå·²è‡ªåŠ¨æ¸…ç†"
```

### åœºæ™¯ 4: ä»»åŠ¡å¤±è´¥è‡ªåŠ¨é‡è¯•
```
è§¦å‘å™¨: Task Status
  - ä»»åŠ¡ ID: 123
  - çŠ¶æ€: failure
æ¡ä»¶: æ— 
åŠ¨ä½œ:
  1. Run Task - é‡æ–°æ‰§è¡Œä»»åŠ¡ 123
é«˜çº§è®¾ç½®:
  - å»¶è¿Ÿæ‰§è¡Œ: 300 ç§’
  - å¤±è´¥ç†”æ–­: 3 æ¬¡
```

## ğŸ“ æ€»ç»“ (Summary)

åœºæ™¯æ¨¡å¼åŠŸèƒ½ä¸ºé’é¾™é¢æ¿æä¾›äº†å¼ºå¤§çš„è‡ªåŠ¨åŒ–èƒ½åŠ›ï¼š

âœ… **å®Œæ•´å®ç°** - ä»æ•°æ®æ¨¡å‹åˆ°å‰ç«¯ç•Œé¢å…¨æ ˆå®ç°
âœ… **çµæ´»é…ç½®** - 5 ç§è§¦å‘å™¨å’Œ 4 ç§åŠ¨ä½œæ»¡è¶³å„ç§éœ€æ±‚
âœ… **å¯é ç¨³å®š** - å¤±è´¥ç†”æ–­ã€é‡è¯•æœºåˆ¶ç¡®ä¿ç³»ç»Ÿç¨³å®š
âœ… **æ˜“äºä½¿ç”¨** - å¯è§†åŒ–é…ç½®ï¼Œæ— éœ€ç¼–å†™ä»£ç 
âœ… **å®Œå–„æ–‡æ¡£** - è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—å’Œ API æ–‡æ¡£
âœ… **å›½é™…åŒ–** - å®Œæ•´çš„ä¸­è‹±æ–‡æ”¯æŒ

è¿™ä¸ªåŠŸèƒ½å°†é’é¾™é¢æ¿ä»ç®€å•çš„å®šæ—¶ä»»åŠ¡ç®¡ç†å·¥å…·å‡çº§ä¸ºæ™ºèƒ½çš„è‡ªåŠ¨åŒ–è¿ç»´ä¸­æ¢ï¼
